#NOTE the lava_test_shell_action fills in the proper interpreter path
# above during target deployment

set -x

usage () {
    echo "USAGE"
}

TEST_CASE_ID="$1"
shift
if [ -z "$TEST_CASE_ID" ]; then
    usage
    exit 1
fi
while [ $# -gt 0 ]; do
    echo $# $1 $2
    case $1 in
        --result)
            shift
            RESULT=$1
            shift
            ;;
        --units)
            shift
            UNITS=$1
            shift
            ;;
        --measurement)
            shift
            MEASUREMENT=$1
            shift
            ;;
        *)
            usage
            exit 1
            ;;
    esac
done

# $LAVA_RESULT_DIR is set by lava-test-shell
result_dir="$LAVA_RESULT_DIR/results/$TEST_CASE_ID"
mkdir -p "$result_dir"

if [ -z "${RESULT+x}" ]; then
    echo "--result must be specified"
    exit 1
else
    echo $RESULT > $result_dir/result
fi

if [ -n "${UNITS+x}" ]; then
    echo $UNITS > $result_dir/units
fi

if [ -n "${MEASUREMENT+x}" ]; then
    echo $MEASUREMENT > $result_dir/measurement
fi