#NOTE the lava_test_shell_action fills in the proper interpreter path
# above during target deployment

set -x

usage () {
    echo "USAGE"
}

TEST_CASE_ID="$1"
shift
FILE="$1"
shift
MIMETYPE="$1"
shift
if [ $# -gt 0 ]; then
    usage
    exit 1
fi
if [ ! -f "$FILE" ]; then
    usage
    exit 1
fi
if [ -z "$TEST_CASE_ID" ]; then
    usage
    exit 1
fi
# $LAVA_ATTACHMENT_DIR is set by lava-test-shell
mkdir -p "$LAVA_ATTACHMENT_DIR/$TEST_CASE_ID"
cp "$FILE" "$LAVA_ATTACHMENT_DIR/$TEST_CASE_ID"
if [ ! -z "$MIMETYPE" ]; then
    echo "$MIMETYPE" > "$LAVA_ATTACHMENT_DIR/$TEST_CASE_ID/${FILE/*\//}.mimetype"
fi
